<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>下载器</title>
    <link rel="Shortcut Icon" href="./images/show.ico" type="image/x-icon">
    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="./js/crypto-js.js"></script>
    <script src="./js/mi1.js"></script>
    <script src="./js/mi2.js"></script>
    <script src="./js/mi3.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .input-sm {
            height: 40px;
            padding: 5px 10px;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 3px;
        }

        .button-sm {
            height: 30px;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 3px;
            margin-top: 10px;
            /*float: right;*/
        }

        .div-con {
            width: 350px;
            height: 400px;
            margin: 0 auto;
        }

        .div-cil-con {
            width: 350px;
        }

    </style>
</head>
<body>
<div class=" div-con" style="background-color:white;margin-top: 100px">
    <h1 class="text-muted" style="margin-bottom: 50px">下载器</h1>
    <div class="div-cil-con">
        <label for="wangYiUrl" class="text-muted">请输入想要下载的歌曲链接：(支持会员下载)</label>
        <input class="form-control input-sm" placeholder="网易云分享的链接" id="wangYiUrl">
        <button id="sendM" type="button" class="btn button-sm btn-outline-primary" style="float: right">下载</button>
    </div>
    <div style="float: none;height: 40px;width: 100%"></div>
    <div class="div-cil-con">
        <label for="douYinUrl" class="text-muted">请输入想要下载的视频链接：</label>
        <input class="form-control input-sm" placeholder="抖音分享的链接" id="douYinUrl">
        <button id="downDouYin" type="button" class="btn btn-outline-primary button-sm" style="float: right">下载</button>
    </div>
</div>

<script>
    $("#downDouYin").click(function () {
        let str = $("#douYinUrl").val();
        if (str == null || str == "") {
            alert("请先输入视频链接");
            return;
        }
        if (str.indexOf("v.douyin.com")<0){
            alert("请输入抖音分享的链接");
            return;
        }
        let url;
        let split = str.split(' ');
        split.forEach(function(element) {
            if (element.indexOf("http")>-1) {
                url = element;
            }
        });
        if (url==null||url==""){
            alert("链接不存在");
            return;
        }
        console.log(url);
        window.location.href = '/down/douyin?' + "url=" + encodeURIComponent(url);
    });


    $("#sendM").click(function () {
        let str = $("#wangYiUrl").val();
        if (str == null || str == "") {
            alert("请先输入歌曲链接");
            return;
        }
        if (str.indexOf("music.163.com")<0){
            alert("请输入网易云分享链接");
            return;
        }
        let id;
        // var str='https://music.163.com/song?id=17346999&userid=351679727';
        // var str='https://music.163.com/song/17346999&userid=351679727';
        if (str.indexOf('song?id=')!=-1) {
            let patt = /(?<=\?id=)\d+/;
             id = str.match(patt);
        }
        if (str.indexOf('song/')!=-1){
            let patt = /(?<=song\/)\d+/;
            id = str.match(patt);
        }
        // var id = str.toString().substring(str.indexOf('song/') + 5, str.indexOf('/?'));
        var a = d('{"ids":"[' + id + ']","level":"standard","encodeType":"aac","csrf_token":""}', "010001", "00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7"
            , "0CoJUm6Qyw8W8jud");
        let params = a.encText;
        let encSecKey = a.encSecKey;
        h = {};
        var b = d('{"id":"' + id + '","c":"[{\\"id\\":\\"' + id + '\\"}]","csrf_token":""}', "010001", "00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7"
            , "0CoJUm6Qyw8W8jud");
        let nameParams = b.encText;
        let nameEncSecKey = b.encSecKey;
        console.log(a + b);
        window.location.href = '/down/netease?' +
            "params=" + encodeURIComponent(encodeURIComponent(params)) +
            "&encSecKey=" + encodeURIComponent(encodeURIComponent(encSecKey)) +
            "&nameParams=" + encodeURIComponent(encodeURIComponent(nameParams)) +
            "&nameEncSecKey=" + encodeURIComponent(encodeURIComponent(nameEncSecKey));
        h = {};
    });

    function a(a) {
        var d, e, b = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789", c = "";
        for (d = 0; a > d; d += 1)
            e = Math.random() * b.length,
                e = Math.floor(e),
                c += b.charAt(e);
        return c
    }

    function b(a, b) {
        var c = CryptoJS.enc.Utf8.parse(b)
            , d = CryptoJS.enc.Utf8.parse("0102030405060708")
            , e = CryptoJS.enc.Utf8.parse(a)
            , f = CryptoJS.AES.encrypt(e, c, {
            iv: d,
            mode: CryptoJS.mode.CBC
        });
        return f.toString()
    }

    function c(a, b, c) {
        var d, e;
        return setMaxDigits(131),
            d = new RSAKeyPair(b, "", c),
            e = encryptedString(d, a)
    }

    var h = {};

    function d(d, e, f, g) {
        var i = a(16);
        return h.encText = b(d, g),
            h.encText = b(h.encText, i),
            h.encSecKey = c(i, e, f),
            h
    }

    function e(a, b, d, e) {
        var f = {};
        return f.encText = c(a + e, b, d),
            f
    }
</script>
</body>
</html>